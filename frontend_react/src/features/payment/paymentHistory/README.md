# ğŸ“Š Payment History Page

Trang lá»‹ch sá»­ thanh toÃ¡n cho há»‡ thá»‘ng Gym Management.

## âœ¨ TÃ­nh nÄƒng

### ğŸ¯ Cho User (KhÃ¡ch hÃ ng)
- âœ… Xem lá»‹ch sá»­ thanh toÃ¡n cá»§a mÃ¬nh
- âœ… Thá»‘ng kÃª tá»•ng quan (tá»•ng Ä‘Æ¡n, Ä‘Ã£ thanh toÃ¡n, Ä‘ang chá», Ä‘Ã£ há»§y)
- âœ… TÃ¬m kiáº¿m theo mÃ£ Ä‘Æ¡n hÃ ng, tÃªn gÃ³i
- âœ… Lá»c theo tráº¡ng thÃ¡i
- âœ… Xem chi tiáº¿t Ä‘Æ¡n hÃ ng
- âœ… LÃ m má»›i dá»¯ liá»‡u

### ğŸ‘¨â€ğŸ’¼ Cho Admin/Manager
- âœ… Xem táº¥t cáº£ Ä‘Æ¡n hÃ ng cá»§a há»‡ thá»‘ng
- âœ… Thá»‘ng kÃª chi tiáº¿t (tá»•ng doanh thu, sá»‘ lÆ°á»£ng xÃ¡c nháº­n thá»§ cÃ´ng...)
- âœ… TÃ¬m kiáº¿m theo tÃªn khÃ¡ch hÃ ng, email, mÃ£ Ä‘Æ¡n
- âœ… Lá»c theo tráº¡ng thÃ¡i thanh toÃ¡n
- âœ… Lá»c theo loáº¡i xÃ¡c thá»±c (PayOS/Manual)
- âœ… Xem thÃ´ng tin khÃ¡ch hÃ ng trong báº£ng
- âœ… Xem chi tiáº¿t Ä‘áº§y Ä‘á»§

## ğŸ“¸ Giao diá»‡n

### Statistics Cards
```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Tá»•ng Ä‘Æ¡n    â”‚ ÄÃ£ TT       â”‚ Äang chá»    â”‚ ÄÃ£ há»§y      â”‚
â”‚    150      â”‚    120      â”‚     20      â”‚      8      â”‚
â”‚             â”‚ 1.200.000â‚«  â”‚             â”‚             â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### Filters
```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ [ğŸ” TÃ¬m kiáº¿m...]  [Tráº¡ng thÃ¡i â–¼]  [XÃ¡c thá»±c â–¼]  [50 Ä‘Æ¡n] â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### Table
```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ MÃ£ Ä‘Æ¡n hÃ ng â”‚ KhÃ¡ch hÃ ng   â”‚ GÃ³i táº­p â”‚ Sá»‘ tiá»n  â”‚ Tráº¡ng thÃ¡iâ”‚ XÃ¡c thá»±c â”‚ NgÃ y táº¡o â”‚ Action â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ #176163...  â”‚ VÆ°Æ¡ng Q.V.   â”‚ gÃ³i     â”‚ 4.950â‚«   â”‚ âœ… ÄÃ£ TT â”‚ ğŸ‘¤ Manualâ”‚ 28/10/25 â”‚   ğŸ‘   â”‚
â”‚             â”‚ vqvinh@...   â”‚ thÃ¡ng   â”‚          â”‚          â”‚          â”‚          â”‚        â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

## ğŸš€ CÃ¡ch sá»­ dá»¥ng

### 1ï¸âƒ£ Import vÃ o Router

```javascript
// App.jsx hoáº·c Router.jsx
import PaymentHistory from '@/features/payment/paymentHistory';

// Trong routes
<Route path="/payment-history" element={<PaymentHistory />} />
```

### 2ï¸âƒ£ Add vÃ o Navigation Menu

```javascript
// Sidebar.jsx hoáº·c Navigation.jsx
{
  path: '/payment-history',
  name: 'Lá»‹ch sá»­ thanh toÃ¡n',
  icon: <ReceiptLongIcon />,
  role: ['user', 'admin', 'manager'] // Ai cÅ©ng cÃ³ thá»ƒ truy cáº­p
}
```

### 3ï¸âƒ£ Truy cáº­p trang

```
http://localhost:3000/payment-history
```

## ğŸ¨ Customization

### Thay Ä‘á»•i mÃ u sáº¯c

Chá»‰nh trong `paymentHistory.css`:

```css
.stat-card-total {
  border-left: 4px solid var(--color-primary, #0d47a1);
}

.stat-card-paid {
  border-left: 4px solid var(--color-success, #2e7d32);
}

/* ... */
```

### Thay Ä‘á»•i sá»‘ lÆ°á»£ng Ä‘Æ¡n hiá»ƒn thá»‹

Trong `paymentHistory.jsx`:

```javascript
// Admin
const result = await PaymentOrderService.getAllOrders({
  limit: 500, // Thay Ä‘á»•i sá»‘ nÃ y
  orderByField: "createdAt",
  orderDirection: "desc",
});

// User
fetchedOrders = await PaymentOrderService.getUserOrders(currentUser.uid, {
  limit: 100, // Thay Ä‘á»•i sá»‘ nÃ y
  orderByField: "createdAt",
  orderDirection: "desc",
});
```

## ğŸ“Š Statistics Display

### Cho User
```javascript
{
  total: 15,              // Tá»•ng Ä‘Æ¡n cá»§a user
  paid: 12,               // ÄÃ£ thanh toÃ¡n
  pending: 2,             // Äang chá»
  cancelled: 1,           // ÄÃ£ há»§y
  totalAmount: 150000,    // Tá»•ng tiá»n
  paidAmount: 120000,     // ÄÃ£ thanh toÃ¡n
  manualConfirmations: 2, // XÃ¡c nháº­n thá»§ cÃ´ng
  payosVerified: 10       // PayOS verified
}
```

### Cho Admin
```javascript
{
  total: 150,             // Tá»•ng táº¥t cáº£ Ä‘Æ¡n
  paid: 120,              
  pending: 20,            
  cancelled: 8,           
  failed: 2,              
  expired: 0,             
  totalAmount: 1500000,   
  paidAmount: 1200000,    
  manualConfirmations: 15,
  payosVerified: 105      
}
```

## ğŸ” Search & Filter

### Search
TÃ¬m kiáº¿m theo:
- âœ… TÃªn khÃ¡ch hÃ ng
- âœ… Email
- âœ… MÃ£ Ä‘Æ¡n hÃ ng
- âœ… TÃªn gÃ³i táº­p

### Status Filter
- âœ… Táº¥t cáº£
- âœ… Äang chá» (PENDING)
- âœ… ÄÃ£ thanh toÃ¡n (PAID)
- âœ… ÄÃ£ há»§y (CANCELLED)
- âœ… Tháº¥t báº¡i (FAILED)
- âœ… Háº¿t háº¡n (EXPIRED)

### Verification Filter
- âœ… Táº¥t cáº£
- âœ… PayOS Verified
- âœ… Manual Confirmation

## ğŸ“± Responsive Design

### Desktop (>960px)
- Hiá»ƒn thá»‹ Ä‘áº§y Ä‘á»§ 4 stat cards ngang
- Table hiá»ƒn thá»‹ táº¥t cáº£ cá»™t
- Filters náº±m ngang

### Tablet (600-960px)
- Stat cards 2x2
- Table thu gá»n má»™t sá»‘ cá»™t
- Filters stack vertical

### Mobile (<600px)
- Stat cards stack vertical
- Table áº©n cá»™t email (admin view)
- Filters stack vertical
- Touch-friendly buttons

## ğŸ¯ Status Colors

```javascript
const statusColors = {
  PAID: 'success',      // Green
  PENDING: 'warning',   // Orange
  CANCELLED: 'error',   // Red
  FAILED: 'error',      // Red
  EXPIRED: 'default',   // Gray
};
```

## ğŸ” Permissions

### User
```javascript
// Chá»‰ xem Ä‘Æ°á»£c Ä‘Æ¡n cá»§a mÃ¬nh
if (currentUser?.uid) {
  fetchedOrders = await PaymentOrderService.getUserOrders(currentUser.uid);
}
```

### Admin/Manager
```javascript
// Xem táº¥t cáº£ Ä‘Æ¡n
if (isAdmin) {
  const result = await PaymentOrderService.getAllOrders();
  fetchedOrders = result.orders;
}
```

## ğŸ”” Features Roadmap

### Phase 1 (Current) âœ…
- [x] Display payment history
- [x] Search & filter
- [x] Statistics cards
- [x] View details
- [x] Responsive design

### Phase 2 (Future) ğŸš§
- [ ] Export to Excel/PDF
- [ ] Print receipt
- [ ] Email receipt to customer
- [ ] Refund functionality (admin)
- [ ] Payment reminders
- [ ] Advanced analytics

### Phase 3 (Advanced) ğŸ’¡
- [ ] Real-time updates (WebSocket)
- [ ] Payment trends chart
- [ ] Revenue forecasting
- [ ] Customer payment behavior analysis
- [ ] Automated reports

## ğŸ› Common Issues

### Issue: "KhÃ´ng thá»ƒ táº£i lá»‹ch sá»­ thanh toÃ¡n"

**NguyÃªn nhÃ¢n:**
- Firestore rules cháº·n truy cáº­p
- User chÆ°a Ä‘Äƒng nháº­p
- Network error

**Giáº£i phÃ¡p:**
```javascript
// Check Firestore rules
match /payment_orders/{orderCode} {
  allow read: if request.auth != null;
}

// Check authentication
if (!currentUser) {
  return <Navigate to="/login" />;
}
```

### Issue: "Statistics khÃ´ng hiá»ƒn thá»‹"

**NguyÃªn nhÃ¢n:**
- KhÃ´ng cÃ³ Ä‘Æ¡n hÃ ng nÃ o
- Error khi fetch statistics

**Giáº£i phÃ¡p:**
```javascript
// Add error handling
try {
  const statistics = await PaymentOrderService.getOrderStatistics();
  setStats(statistics);
} catch (err) {
  console.error("Stats error:", err);
  // Show default stats or hide section
}
```

### Issue: "Filters khÃ´ng hoáº¡t Ä‘á»™ng"

**NguyÃªn nhÃ¢n:**
- Case-sensitive search
- Wrong field comparison

**Giáº£i phÃ¡p:**
```javascript
// Always use toLowerCase for search
const matchSearch = 
  order.userName.toLowerCase().includes(searchTerm.toLowerCase());
```

## ğŸ’» Development

### Run dev server
```bash
cd frontend_react
npm run dev
```

### Test with mock data
```javascript
// Create mock orders in Firestore
const mockOrders = [
  {
    orderCode: 1234567890,
    userId: "test-user-id",
    userName: "Test User",
    // ... other fields
  }
];
```

### Debug
```javascript
// Add console logs
console.log("Filtered orders:", filteredOrders);
console.log("Search term:", searchTerm);
console.log("Status filter:", statusFilter);
```

## ğŸ“š Dependencies

```json
{
  "@mui/material": "^5.x",
  "@mui/icons-material": "^5.x",
  "firebase": "^10.x",
  "react": "^18.x"
}
```

## ğŸ“ Code Examples

### Add custom filter
```javascript
const [customFilter, setCustomFilter] = useState("");

const filteredOrders = orders.filter((order) => {
  // Your custom filter logic
  return order.amount > customFilter;
});
```

### Export to Excel
```javascript
import * as XLSX from 'xlsx';

const exportToExcel = () => {
  const ws = XLSX.utils.json_to_sheet(filteredOrders.map(o => ({
    'MÃ£ Ä‘Æ¡n': o.orderCode,
    'KhÃ¡ch hÃ ng': o.userName,
    'Sá»‘ tiá»n': o.amount,
    // ... other fields
  })));
  
  const wb = XLSX.utils.book_new();
  XLSX.utils.book_append_sheet(wb, ws, "Payment History");
  XLSX.writeFile(wb, "payment-history.xlsx");
};
```

### Real-time updates
```javascript
import { onSnapshot } from 'firebase/firestore';

useEffect(() => {
  const q = query(
    collection(db, "payment_orders"),
    where("userId", "==", currentUser.uid)
  );
  
  const unsubscribe = onSnapshot(q, (snapshot) => {
    const orders = snapshot.docs.map(doc => 
      PaymentOrderModel.fromFirestore(doc)
    );
    setOrders(orders);
  });
  
  return () => unsubscribe();
}, [currentUser]);
```

---

**Created:** 2025-10-29  
**Author:** GitHub Copilot  
**Version:** 1.0.0
