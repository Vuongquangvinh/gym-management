# ğŸ“‹ Tá»•ng há»£p tÃ­nh nÄƒng chÆ°a hoÃ n thiá»‡n - Gym Management System

**NgÃ y táº¡o:** 10/12/2024  
**Tráº¡ng thÃ¡i dá»± Ã¡n:** 85% hoÃ n thiá»‡n

---

## ğŸ¯ Tá»•ng quan

Há»‡ thá»‘ng Gym Management Ä‘Ã£ hoÃ n thÃ nh **85%** cÃ¡c chá»©c nÄƒng chÃ­nh. DÆ°á»›i Ä‘Ã¢y lÃ  danh sÃ¡ch cÃ¡c tÃ­nh nÄƒng cÃ²n thiáº¿u hoáº·c chÆ°a hoÃ n thiá»‡n, Ä‘Æ°á»£c sáº¯p xáº¿p theo thá»© tá»± Æ°u tiÃªn.

---

## âš ï¸ HIGH PRIORITY - Cáº§n hoÃ n thÃ nh ngay

### 1. **Reports Module (Admin Dashboard)**

**File hiá»‡n táº¡i:** `frontend_react/src/features/admin/pages/Reports.jsx` (5 dÃ²ng - placeholder)

**Tráº¡ng thÃ¡i:** âŒ CHÆ¯A THá»°C HIá»†N (Chá»‰ cÃ³ placeholder)

**MÃ´ táº£:** Module bÃ¡o cÃ¡o tÃ i chÃ­nh vÃ  thá»‘ng kÃª cho quáº£n trá»‹ viÃªn

**TÃ­nh nÄƒng cáº§n bá»• sung:**

#### 1.1 Revenue Reports (BÃ¡o cÃ¡o Doanh thu)
- ğŸ“Š Biá»ƒu Ä‘á»“ doanh thu theo ngÃ y/tuáº§n/thÃ¡ng/quÃ½/nÄƒm
- ğŸ’° Tá»•ng doanh thu theo gÃ³i táº­p (Gym packages vs PT packages)
- ğŸ“ˆ So sÃ¡nh doanh thu giá»¯a cÃ¡c ká»³ (YoY, MoM, QoQ)
- ğŸ¯ PhÃ¢n tÃ­ch doanh thu theo nguá»“n:
  * GÃ³i táº­p thÆ°á»ng (gym packages)
  * GÃ³i PT (personal training)
  * Thu nháº­p khÃ¡c (other revenue)
- ğŸ“‰ Xu hÆ°á»›ng doanh thu (trend analysis)

#### 1.2 PT Performance Analytics (PhÃ¢n tÃ­ch hiá»‡u suáº¥t PT)
- ğŸ‘¤ Sá»‘ buá»•i táº­p hoÃ n thÃ nh/PT
- ğŸ’µ Doanh thu táº¡o ra/PT
- ğŸ“Š Tá»· lá»‡ khÃ¡ch hÃ ng giá»¯ chÃ¢n (client retention rate)
- â­ ÄÃ¡nh giÃ¡ trung bÃ¬nh/PT
- ğŸ“… Lá»‹ch lÃ m viá»‡c vÃ  tá»· lá»‡ kháº£ dá»¥ng

#### 1.3 Member Statistics (Thá»‘ng kÃª ThÃ nh viÃªn)
- ğŸ“ˆ Xu hÆ°á»›ng thÃ nh viÃªn má»›i
- ğŸ‘¥ Sá»‘ lÆ°á»£ng thÃ nh viÃªn active vs inactive
- ğŸ“¦ PhÃ¢n bá»‘ theo loáº¡i gÃ³i táº­p
- ğŸ”„ Tá»· lá»‡ gia háº¡n (renewal rate)
- ğŸ“Š Äá»™ tuá»•i trung bÃ¬nh vÃ  phÃ¢n khÃºc demographics

#### 1.4 Export Functionality (Xuáº¥t bÃ¡o cÃ¡o)
- ğŸ“‘ Export Excel (sá»­ dá»¥ng thÆ° viá»‡n `xlsx`)
- ğŸ“„ Export PDF (sá»­ dá»¥ng thÆ° viá»‡n `jsPDF` hoáº·c `react-pdf`)
- ğŸ“Š Export CSV (cho data portability)
- ğŸ“… TÃ¹y chá»n export theo khoáº£ng thá»i gian
- ğŸ“§ Email report tá»± Ä‘á»™ng (optional)

**Files cáº§n táº¡o:**
```
frontend_react/src/features/admin/pages/
â”œâ”€â”€ Reports.jsx                          # Thay tháº¿ placeholder hiá»‡n táº¡i
â”œâ”€â”€ Reports.module.css                   # CSS Modules cho Reports
â””â”€â”€ components/
    â”œâ”€â”€ RevenueChart.jsx                 # Biá»ƒu Ä‘á»“ doanh thu
    â”œâ”€â”€ PTPerformanceTable.jsx           # Báº£ng hiá»‡u suáº¥t PT
    â”œâ”€â”€ MemberStats.jsx                  # Thá»‘ng kÃª thÃ nh viÃªn
    â””â”€â”€ ExportButtons.jsx                # NÃºt export Excel/PDF/CSV

frontend_react/src/services/
â””â”€â”€ revenue-report.service.js            # Service xá»­ lÃ½ dá»¯ liá»‡u bÃ¡o cÃ¡o
```

**ThÆ° viá»‡n cáº§n cÃ i Ä‘áº·t:**
```bash
npm install xlsx jspdf chart.js react-chartjs-2
```

**Estimated effort:** 2-3 ngÃ y

---

## ğŸ”¶ MEDIUM PRIORITY - NÃªn hoÃ n thÃ nh

### 2. **Advanced Revenue Analytics**

**File liÃªn quan:** 
- `frontend_react/src/firebase/lib/features/revenue/revenue.service.js`
- `REVENUE_SYSTEM_IMPLEMENTATION_GUIDE.md` (Phase 2 - chÆ°a thá»±c hiá»‡n)

**Tráº¡ng thÃ¡i:** âš ï¸ ÄANG THá»°C HIá»†N PHASE 1 (Basic revenue tracking hoÃ n thÃ nh)

**MÃ´ táº£:** Má»Ÿ rá»™ng chá»©c nÄƒng phÃ¢n tÃ­ch doanh thu hiá»‡n táº¡i vá»›i cÃ¡c tÃ­nh nÄƒng nÃ¢ng cao

**TÃ­nh nÄƒng cáº§n bá»• sung:**

#### 2.1 Extended Revenue Service Methods
```javascript
// ThÃªm vÃ o revenue.service.js:

/**
 * Get revenue by week
 * @param {Date} startDate - NgÃ y báº¯t Ä‘áº§u tuáº§n
 * @param {Date} endDate - NgÃ y káº¿t thÃºc tuáº§n
 * @returns {Promise<Object>} Revenue summary by week
 */
static async getRevenueByWeek(startDate, endDate) {
  // Implementation needed
}

/**
 * Get revenue by quarter
 * @param {number} year - NÄƒm
 * @param {number} quarter - QuÃ½ (1-4)
 * @returns {Promise<Object>} Revenue summary by quarter
 */
static async getRevenueByQuarter(year, quarter) {
  // Implementation needed
}

/**
 * Get revenue by year
 * @param {number} year - NÄƒm
 * @returns {Promise<Object>} Revenue summary by year
 */
static async getRevenueByYear(year) {
  // Implementation needed
}

/**
 * Compare revenue between two periods
 * @param {Date} period1Start - Báº¯t Ä‘áº§u ká»³ 1
 * @param {Date} period1End - Káº¿t thÃºc ká»³ 1
 * @param {Date} period2Start - Báº¯t Ä‘áº§u ká»³ 2
 * @param {Date} period2End - Káº¿t thÃºc ká»³ 2
 * @returns {Promise<Object>} Comparison result vá»›i variance
 */
static async compareRevenue(period1Start, period1End, period2Start, period2End) {
  // Implementation needed
}

/**
 * Get revenue generated by specific PT
 * @param {string} ptId - PT employee ID
 * @param {Date} startDate - Optional start date
 * @param {Date} endDate - Optional end date
 * @returns {Promise<Object>} PT revenue summary
 */
static async getRevenueByPT(ptId, startDate, endDate) {
  // Implementation needed
}
```

#### 2.2 Caching Layer
- Táº¡o `revenue-cache.service.js` Ä‘á»ƒ cache káº¿t quáº£ query phá»©c táº¡p
- Giáº£m sá»‘ láº§n query Firestore cho dá»¯ liá»‡u khÃ´ng thay Ä‘á»•i thÆ°á»ng xuyÃªn
- Implement cache invalidation strategy

#### 2.3 Optimized Firestore Queries
- Táº¡o composite indexes cho queries phá»©c táº¡p
- Batch queries khi cáº§n nhiá»u data ranges
- Pagination cho large datasets

**Files cáº§n táº¡o/sá»­a:**
```
frontend_react/src/firebase/lib/features/revenue/
â”œâ”€â”€ revenue.service.js                   # Extend vá»›i methods má»›i
â”œâ”€â”€ revenue-cache.service.js             # NEW: Caching layer
â””â”€â”€ revenue-analytics.service.js         # NEW: Advanced analytics

backend/firestore.indexes.json           # ThÃªm indexes má»›i
```

**Estimated effort:** 1-2 ngÃ y

---

## ğŸ”· LOW PRIORITY - Nice to have

### 3. **Budget Management UI**

**File Model Ä‘Ã£ cÃ³:** `frontend_react/src/firebase/lib/features/budget/budget.model.js` (hoÃ n chá»‰nh)

**Tráº¡ng thÃ¡i:** âš ï¸ MODEL HOÃ€N THÃ€NH, THIáº¾U UI

**MÃ´ táº£:** Giao diá»‡n quáº£n lÃ½ ngÃ¢n sÃ¡ch cho admin (káº¿ hoáº¡ch chi tiÃªu)

**TÃ­nh nÄƒng cáº§n bá»• sung:**

#### 3.1 Budget CRUD Operations
- âœï¸ **Create Budget:** Táº¡o ngÃ¢n sÃ¡ch má»›i cho thÃ¡ng/quÃ½/nÄƒm
  * Form nháº­p tÃªn, mÃ´ táº£, period (monthly/quarterly/yearly)
  * Nháº­p planned amount cho tá»«ng expense category
  * Preview tá»•ng planned amount
  
- ğŸ‘ï¸ **View Budget List:** Hiá»ƒn thá»‹ danh sÃ¡ch budgets
  * Filter theo period type, status
  * Sort theo date, amount
  * Display tá»•ng planned, actual, variance
  
- âœï¸ **Edit Budget:** Chá»‰nh sá»­a budget (chá»‰ khi status = DRAFT)
  * Update planned amounts
  * Edit description, notes
  
- ğŸ—‘ï¸ **Delete/Cancel Budget:** XÃ³a hoáº·c cancel budget

#### 3.2 Budget vs Actual Tracking
- ğŸ“Š Visual comparison chart (planned vs actual)
- ğŸ¯ Progress indicators cho tá»«ng category
- âš ï¸ Warning indicators khi over budget
- âœ… Success indicators khi under budget

#### 3.3 Budget Actions (sá»­ dá»¥ng methods cÃ³ sáºµn tá»« BudgetModel)
```javascript
// CÃ¡c methods Ä‘Ã£ cÃ³ trong budget.model.js:
await budget.activate()           // KÃ­ch hoáº¡t budget
await budget.complete()           // HoÃ n thÃ nh budget
await budget.cancel()             // Há»§y budget
await budget.updateActualAmounts() // Cáº­p nháº­t actual tá»« expenses
```

**Files cáº§n táº¡o:**
```
frontend_react/src/features/admin/pages/
â”œâ”€â”€ BudgetManagement.jsx                 # Main budget page
â”œâ”€â”€ BudgetManagement.module.css          # CSS Modules
â””â”€â”€ components/
    â”œâ”€â”€ BudgetForm.jsx                   # Form táº¡o/sá»­a budget
    â”œâ”€â”€ BudgetList.jsx                   # Danh sÃ¡ch budgets
    â”œâ”€â”€ BudgetDetailModal.jsx            # Chi tiáº¿t budget
    â””â”€â”€ BudgetProgressChart.jsx          # Biá»ƒu Ä‘á»“ progress
```

**UI Components cáº§n thiáº¿t:**
- Form vá»›i date picker (monthly/quarterly/yearly selector)
- Category budget input table
- Progress bars cho each category
- Status badges (DRAFT/ACTIVE/COMPLETED/CANCELLED)
- Action buttons (Activate/Complete/Cancel)

**Estimated effort:** 1-2 ngÃ y

---

## ğŸ“Š Tráº¡ng thÃ¡i tá»•ng há»£p

| Module | Status | Priority | Effort | Completion |
|--------|--------|----------|--------|------------|
| **Reports Module** | âŒ Placeholder only | ğŸ”´ HIGH | 2-3 days | 0% |
| **Advanced Revenue Analytics** | âš ï¸ Phase 1 done | ğŸŸ¡ MEDIUM | 1-2 days | 40% |
| **Budget Management UI** | âš ï¸ Model only | ğŸŸ¢ LOW | 1-2 days | 30% |

**Overall Project Completion:** 85% â†’ 100% (sau khi hoÃ n thÃ nh 3 modules trÃªn)

**Total estimated effort:** 4-7 ngÃ y lÃ m viá»‡c

---

## ğŸ¯ Roadmap Ä‘á» xuáº¥t

### Week 1: Reports Module (HIGH PRIORITY)
**Days 1-2:** Revenue Reports
- Táº¡o RevenueChart component vá»›i Chart.js
- Implement revenue breakdown by package type
- Add date range selector (day/week/month/quarter/year)

**Day 3:** PT Performance & Member Stats
- Create PTPerformanceTable component
- Create MemberStats component
- Integrate with existing data

**Day 4:** Export Functionality
- Install xlsx, jsPDF libraries
- Implement Excel export
- Implement PDF export
- Add CSV export

### Week 2: Advanced Revenue Analytics (MEDIUM PRIORITY)
**Days 1-2:** Extended Revenue Service
- Implement getRevenueByWeek/Quarter/Year
- Implement compareRevenue
- Implement getRevenueByPT
- Add caching layer
- Optimize Firestore queries

### Week 3: Budget Management UI (LOW PRIORITY - Optional)
**Days 1-2:** Budget UI
- Create BudgetManagement page
- Create BudgetForm component
- Implement CRUD operations
- Add progress visualization
- Connect vá»›i existing BudgetModel

---

## ğŸ”§ Technical Dependencies

### NPM Packages cáº§n cÃ i Ä‘áº·t:
```json
{
  "dependencies": {
    "xlsx": "^0.18.5",              // Excel export
    "jspdf": "^2.5.1",              // PDF export
    "jspdf-autotable": "^3.7.1",    // PDF tables
    "chart.js": "^4.4.0",           // Charts
    "react-chartjs-2": "^5.2.0",    // React wrapper cho Chart.js
    "date-fns": "^2.30.0"           // Date utilities (cÃ³ thá»ƒ Ä‘Ã£ cÃ³)
  }
}
```

### Firestore Indexes cáº§n táº¡o:
```json
// backend/firestore.indexes.json
{
  "indexes": [
    {
      "collectionGroup": "payment_orders",
      "queryScope": "COLLECTION",
      "fields": [
        { "fieldPath": "status", "order": "ASCENDING" },
        { "fieldPath": "paidAt", "order": "DESCENDING" }
      ]
    },
    {
      "collectionGroup": "payment_orders",
      "queryScope": "COLLECTION",
      "fields": [
        { "fieldPath": "packageType", "order": "ASCENDING" },
        { "fieldPath": "paidAt", "order": "DESCENDING" }
      ]
    }
  ]
}
```

---

## ğŸ“ Notes

### ÄÃ£ hoÃ n thÃ nh:
- âœ… All PT components Ä‘Ã£ convert sang CSS Modules
- âœ… All Admin components Ä‘Ã£ sá»­ dá»¥ng CSS Modules
- âœ… Dashboard, Settings, Packages, Employees, Members, Checkins Ä‘Ã£ hoÃ n thiá»‡n
- âœ… Payment system integration (PayOS)
- âœ… Chat system vá»›i FCM
- âœ… Face recognition check-in/out
- âœ… PT scheduling system
- âœ… Notification system (Firebase + local)
- âœ… Financial dashboard (basic THU - CHI - Lá»¢I NHUáº¬N)
- âœ… Expense tracking system
- âœ… Revenue tracking system (Phase 1)
- âœ… Budget Model (complete vá»›i full methods)

### ChÆ°a hoÃ n thÃ nh:
- âŒ Reports Module UI (0%)
- âš ï¸ Advanced Revenue Analytics (40% - thiáº¿u extended methods)
- âš ï¸ Budget Management UI (30% - chá»‰ cÃ³ model, chÆ°a cÃ³ UI)

### Optional Enhancements (Future):
- [ ] Real-time report updates (vá»›i WebSocket hoáº·c Firestore listeners)
- [ ] Automated email reports
- [ ] Forecasting vÃ  predictive analytics
- [ ] Custom report builder
- [ ] Report scheduling (daily/weekly/monthly auto-reports)
- [ ] Multi-gym support (náº¿u má»Ÿ rá»™ng chain phÃ²ng gym)

---

## ğŸš€ Quick Start Guide

### Äá»ƒ tiáº¿p tá»¥c phÃ¡t triá»ƒn Reports Module:

1. **Install dependencies:**
```bash
cd frontend_react
npm install xlsx jspdf jspdf-autotable chart.js react-chartjs-2
```

2. **Táº¡o revenue-report.service.js:**
```bash
# Táº¡o file trong src/services/
touch src/services/revenue-report.service.js
```

3. **Thay tháº¿ Reports.jsx placeholder:**
```bash
# Edit file src/features/admin/pages/Reports.jsx
# Copy cáº¥u trÃºc tá»« Settings.jsx hoáº·c Dashboard.jsx lÃ m template
```

4. **Táº¡o CSS Module:**
```bash
touch src/features/admin/pages/Reports.module.css
```

5. **Test vá»›i dá»¯ liá»‡u tháº­t:**
```javascript
// Trong Reports.jsx
import { RevenueService } from '../../../firebase/lib/features/revenue';

// Load data
const loadRevenueData = async () => {
  const endDate = new Date();
  const startDate = new Date();
  startDate.setMonth(startDate.getMonth() - 1);
  
  const data = await RevenueService.getRevenueByDateRange(startDate, endDate);
  console.log('Revenue data:', data);
};
```

---

**Created:** 10/12/2024  
**Last Updated:** 10/12/2024  
**Author:** GitHub Copilot  
**Version:** 1.0
